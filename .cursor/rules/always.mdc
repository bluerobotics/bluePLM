---
description: Critical rules that must always be followed
alwaysApply: true
---

# Critical Rules

## Tool Usage (Terminal = System Ops Only)

| Task | Use This | Never This |
|------|----------|------------|
| Read | `read_file` | `cat`, `Get-Content` |
| Write | `write` | `echo >`, `Set-Content` |
| Edit | `search_replace` | `sed`, `awk` |
| Search | `grep` | `rg`, `findstr` |

Terminal is for: `git`, `npm`, `npx`, build scripts only.

## Schema Versioning (BOTH files, every time)

1. `supabase/schema.sql` → bump INSERT version
2. `src/lib/schemaVersion.ts` → bump EXPECTED_SCHEMA_VERSION

Mismatch = users see "database newer/older than app" warnings.

## Release Gate

Before creating a git tag:

```
npm run typecheck        # must pass
package.json             # version bumped
CHANGELOG.md             # entry added
docs/                    # updated if user-facing
```

## Plans Location

Create `.plan.md` files in repo's `.cursor/plans/` — never user home dir.

## CLI Commands

New commands go in `src/lib/commands/handlers/`, register in `index.ts`.
